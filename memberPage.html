<!DOCTYPE html>
<html>
<head>
<!-- 画面の幅を使用している端末に依存する。加えてズームを許可しない。 -->
<meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=yes">
<meta charset="UTF-8">
<title>DDTFlowers</title>
<!-- メインのCSSファイルを読み込む。 -->
<link href="css/style.css" rel="stylesheet" type="text/css">
<!-- 会員ページのcssを読み込む -->
<link href="css/memberPage.css" rel="stylesheet" type="text/css">
<!-- jqueryUIのcssを読み込む -->
<link rel="stylesheet" type="text/css" href="css/jquery-ui-1.10.4.custom.min.css" media="screen" />
<!-- jQueryの本体を読み込む。 -->
<script src="js/jquery-1.11.0.min.js"></script>
<!-- jQueryUIを読み込む。 -->
<script type="text/javascript" src="js/jquery-ui-1.9.2.custom.min.js"></script>
<!-- タグを作成するJSの関数群を読み込む -->
<script type="text/javascript" src="js/createTag.js"></script>
<!-- easytabsの本体を読み込む。 -->
<script type="text/javascript" src="js/jquery.easytabs.js"></script>
<!-- 入力チェック機能のjQueryプラグイン -->
<script src="js/jquery.validate.min.js"></script>
<!-- validate.jsの日本語対応プラグイン -->
<script type="text/javascript" src="js/messages_ja.js"></script>
<!-- タッチ操作のライブラリ。 -->
<script src="js/jquery.finger.js"></script>
<!-- 画面操作の処理を記述したJSファイルを読み込む。 -->
<script type="text/javascript" src="js/controlPage.js"></script>
<!-- ダイアログ作成の処理を記述したJSファイルを読み込む。 -->
<script type="text/javascript" src="js/createDialog.js"></script>
<!-- 小規模のの処理を記述したJSファイルを読み込む。 -->
<script type="text/javascript" src="js/createLittleContent.js"></script>
<!-- ユーザのアクションに対応するイベントを定義したJSファイルを読み込む。 -->
<script type="text/javascript" src="js/controlAction.js"></script>
<!-- ユーザのアクションに対応するイベントを定義したJSファイルを読み込む。 -->
<script type="text/javascript" src="js/dailyClasses.js"></script>
</head>
<body>
	<div id="container">
		<div class="main">
			<script>
				try{
					hideNormalHeader();	//通常ページのヘッダーを隠す
					
					//変更者:T.Yamamoto 指示者H.Kaneko 内容:memberPageCreatorが重複するため、コメントにしました。
					memberPageCreator = new createTag();
					memberPageCreator.getJsonFile('source/memberPage.json');
					//// 会員共通のパーツのJSONを取得する。
					memberPageCreator.getJsonFile('source/memberCommon.json');
					//パーツのテンプレートのDOMを取得する。
					memberPageCreator.getDomFile('template/common.html');
					// 会員共通のパーツのJSONを取得する。
					memberPageCreator.getDomFile('template/memberCommon.html');
					// 会員ページのjsonを読み込む
					memberPageCreator.getDomFile('template/memberPage.html');
					//ユーザ情報のテキストをDBから取得する
					memberPageCreator.getJsonFile('php/GetJSONString.php', memberPageCreator.json['accountHeader'], 'accountHeader');
	
					//accountHeaderから会員IDを取得する。
					var memberInfo = memberPageCreator.json.accountHeader !== void(0) ? memberPageCreator.json.accountHeader.user_key.value : '';
					
					// 会員ページヘッダーを作る
					memberPageCreator.outputTag('accountHeader','memberHeader');
					// バナー領域を作る
					memberPageCreator.outputTag('userBanner');
					//告知領域のテキストをDBから取得する
					memberPageCreator.getJsonFile('php/GetJSONString.php', memberPageCreator.json['advertise'], 'advertise');
					// 告知領域を作る
					memberPageCreator.outputTag('advertise');
					//通知領域の内容があれば
					if(memberPageCreator.json.advertise.message_title.text){
						$('.advertise').css('display', 'block');		//通知領域を表示する
					}
					// 会員ページのカレンダーを作る
					memberPageCreator.outputTag('lessonCalendar', 'calendar');
	
					// 日ごと授業のjsonを読み込む
					memberPageCreator.getJsonFile('source/eachDayLesson.json');
					// 日ごと授業のテンプレートを読み込む
					memberPageCreator.getDomFile('template/eachDayLesson.html');
	
					//予約一覧ダイアログを作る
					var lessonList = new tagDialog('reserveLessonListDialog', '', dialogOption['reserveLessonListDialog'], function(){
						// 日ごとダイアログ領域を作る
						memberPageCreator.outputTag('reserveLessonListDialog', 'dialog', 'body');
					//予約キャンセルダイアログを作る
					// var cancelLessonLesson = new TagDialog('cancelLessonDialog', '', dialogOption['canselLessonDialog'], function() {
						//予約キャンセルダイアログのdomを作る
						// memberPageCreator.outputTag('canselLessonDialog', 'canselLessonDialog', 'body');
					// });
					// テーブルのステータスを概要を表示する領域を作る
					// memberPageCreator.outputTag('lessonStatus', 'lessonStatus', '.memberInfomation');
					// 予約一覧テーブルの値を置換する
					// lessonTableValueInput('.lessonTable', eachDayLessonTable, "callReservedLessonValue");
					});
	
					//予約確定ダイアログを作る
				//	var confirmReserveLesson = new tagDialog(STR_MEMBER_RESERVED_CONFIRM_DIALOG, '', dialogOption[STR_MEMBER_RESERVED_CONFIRM_DIALOG], function(){
						// テーブルのステータスを概要を表示する領域を作る
				//		memberPageCreator.outputTag(STR_MEMBER_RESERVED_CONFIRM_DIALOG, STR_MEMBER_RESERVED_CONFIRM_DIALOG,  STR_BODY);
				//	});
					// カレンダーを作り、クリックでダイアログ作成を作る
					var memCalendar = new memberCalendar('.lessonCalendar', 90, memberInfo, lessonList);
					memCalendar.create();	//カレンダーを実際に作成する
	
					// タブ機能を作る
					memberPageCreator.outputTag('lessonTab');
					//予約中授業テーブル用のJSON配列を取得する
					memberPageCreator.getJsonFile('php/GetJSONArray.php', memberPageCreator.json['reservedLessonTable'], 'reservedLessonTable');
					//会員が予約できる授業を取得するために会員番号をクエリの置換する場所に入れる
					memberPageCreator.json.memberCanReserveLesson.user_key.value = memberPageCreator.json.accountHeader.user_key.value;
					//予約できる授業のテーマにをDBから取り出す
					memberPageCreator.getJsonFile('php/GetJSONArray.php', memberPageCreator.json['memberCanReserveLesson'], 'memberCanReserveLesson');
					//予約中授業のテーマをセレクトボックスにDBから取り出した値を入れるために連想配列にDBから取り出したテーマの値を入れる
					setSelectboxText(memberPageCreator.json.memberCanReserveLesson.table, memberPageCreator.json.selectTheme.selectThemebox.themeValue, 'lesson_name');
					// 予約済み授業のタブ内コンテンツを作る
					memberPageCreator.outputTag('alreadyReserved', 'tabInContent', '.tabContentArea');
					// 受講済み授業のタブ内コンテンツを作る
					memberPageCreator.outputTag('finishedLesson', 'tabInContent', '.tabContentArea');
	
					// 予約済み授業と受講済み授業についてタブを作る
					createTab('#tab-container');
					//受講済み授業タブをクリックしたときに受講済み授業の内容を表示する
					createContentTriggerClick('.tabLink[href="#finishedLesson"]', createMemberFinishedLessonContent);
	
	
					//予約済み授業の絞り込み領域を作る
					memberPageCreator.outputTag('selectTheme', 'selectTheme', '#alreadyReserved');
					//予約中の授業があった時のテーブルを作る
					if(memberPageCreator.json['reservedLessonTable']['table'][0]) {
						// 予約中授業のテーブルを作る
						memberPageCreator.outputTagTable('reservedLessonTable','reservedLessonTable','.alreadyReserved');
					}
					
					//セレクトボックスのvalueを画面に表示されている値にする
					setSelectboxValue('.selectThemebox');
	
	 				// 予約中授業の連想配列を変数に入れる 
					var reservedNow = memberPageCreator.json['reservedLessonTable']['table'];
					// 予約中テーブルのテーブルの値をしかるべき値にする
					lessonTableValueInput('.reservedLessonTable', reservedNow, "callMemberLessonValue");
	
					//予約キャンセルダイアログを作る
					//var cancelLesson = new tagDialog('cancelLessonDialog', '', dialogOption['cancelLessonDialog'], function() {
						// 予約キャンセルダイアログのdomを作る
					//	memberPageCreator.outputTag('cancelLessonDialog', 'cancelLessonDialog', 'body');
						//キャンセルダイアログの注意の部分をアコーディオンにしてその機能を実装する
					//	accordionSetting('.lessonAccordion', '.attention');
					});
					//キャンセルダイアログを予約中授業テーブルから開く処理
			//		cancelDialogOpen(cancelLesson, memberInfo);
					//予約中授業テーブルのクリック範囲レコードにクラス属性を付ける
					setTableRecordClass('reservedLessonTable', 'targetCancelReservedLesson'); 
					//予約中授業テーブル絞り込みボタン機能を実装する
					reloadTableTriggerEvent('#alreadyReserved .selectThemebox', CHANGE, 'reservedLessonTable');
					addlogoutEvent('.logoutLink');	//ログアウトボタンのイベントを登録する。
				}catch(e){
					console.log(e);
				}
			</script>
		</div>
	</div>
</body>
</html>
