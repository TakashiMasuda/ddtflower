<!DOCTYPE html>
<html>
<!--
	ファイル名:adminPage.html
	概要　　　:管理者ページ
	作成日　　:2015.0612
	作成者　　:T.Masuda
	パス　　　:/adminPage.html
-->
<head>
<!-- 画面の幅を使用している端末に依存する。加えてズームを許可しない。 -->
<meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=yes">
<meta charset="UTF-8">
<title>DDTFlowers/管理者</title>
<!-- 共通のcssを読み込む-->
<link rel="stylesheet" type="text/css" href="css/style.css" media="screen" />
<!-- 会員ページのcssを読み込む -->
<link rel="stylesheet" type="text/css" href="css/memberPage.css" media="screen" />
<!-- jqueryUIのcssを読み込む -->
<link rel="stylesheet" type="text/css" href="css/jquery-ui-1.10.4.custom.min.css" media="screen" />
<!-- jQueryの本体を読み込む。 -->
<script src="js/jquery-1.11.0.min.js"></script>
<!-- jQueryUIを読み込む。 -->
<script type="text/javascript" src="js/jquery-ui-1.9.2.custom.min.js"></script>
<!-- タグを作成するJSの関数群を読み込む -->
<script type="text/javascript" src="js/createTag.js"></script>
<!-- easytabsの本体を読み込む。 -->
<script type="text/javascript" src="js/jquery.easytabs.js"></script>
<!-- 入力チェック機能のjQueryプラグイン -->
<script src="js/jquery.validate.min.js"></script>
<!-- validate.jsの日本語対応プラグイン -->
<script type="text/javascript" src="js/messages_ja.js"></script>
<!-- 画面操作の処理を記述したJSファイルを読み込む。 -->
<script type="text/javascript" src="js/controlPage.js"></script>
<!-- ダイアログ作成の処理を記述したJSファイルを読み込む。 -->
<script type="text/javascript" src="js/createDialog.js"></script>
<!-- 小規模のの処理を記述したJSファイルを読み込む。 -->
<script type="text/javascript" src="js/createLittleContent.js"></script>
<!-- ユーザのアクションに対応するイベントを定義したJSファイルを読み込む。 -->
<script type="text/javascript" src="js/controlAction.js"></script>
<!-- ユーザのアクションに対応するイベントを定義したJSファイルを読み込む。 -->
<script type="text/javascript" src="js/dailyClasses.js"></script>
</head>
<body>
	<div id="container">
		<div class="main">
			<!-- 管理者ページのcssを読み込む -->
<link rel="stylesheet" type="text/css" href="css/adminPage.css" media="screen" />
			<script>
			//ドキュメント配備後
			$(document).ready(function(){
				// creator = new createTag();
				// ユーザーページのパーツのテンプレートのJSONを取得する。
				creator.getJsonFile('source/commonUser.json');
				// 管理者ページ共通のパーツのJSONを取得する。
				creator.getJsonFile('source/adminCommon.json');

				// ユーザーページのパーツのテンプレートのDOMを取得する。
				creator.getDomFile('template/commonUser.html');
				// 管理者ページ共通のパーツのJSONを取得する。
				creator.getDomFile('template/adminCommon.html');
				
				//パーツのHTMLを順次作成し、画面に追加していく
				//ユーザ情報のテキストをDBから取得する
				creator.getJsonFile('php/GetJSONString.php', creator.json['adminHeader'], 'adminHeader');
				//ヘッダー
				creator.outputTag('adminHeader');
				//タブ領域
				creator.outputTag('adminTab', 'tabContainer');
				//タブコンテンツ5個
				creator.outputTag('dayReserver','tabInContent', '.tabContentArea');
				creator.outputTag('lecturePermit','tabInContent', '.tabContentArea');
				creator.outputTag('userList','tabInContent', '.tabContentArea');
				creator.outputTag('lessonDetail','tabInContent', '.tabContentArea');
				creator.outputTag('mailMagaAndAnnounce','tabInContent', '.tabContentArea');
				
				//日ごと予約者一覧タブのコンテンツ
				//選択された日付を表示する領域
				creator.outputTag('dateBelt', 'dateBelt', '#dayReserver');
				//日付選択パーツのセット
				creator.outputTag('dateSelect', 'dateSelect', '#dayReserver');
				//日付ページングを実装する
				nowDatePaging('dateBelt');
				// 日ごと予約者一覧テーブル用のJSON配列を取得する
				creator.getJsonFile('php/GetJSONArray.php', creator.json['eachDayReservedInfoTable'], 'eachDayReservedInfoTable');
				//日ごと予約者の情報がないときにテーブルを作らない
				if(creator.json.eachDayReservedInfoTable.table[0]) {
					//日ごと予約者一覧テーブルを作る
					creator.outputTagTable('eachDayReservedInfoTable','eachDayReservedInfoTable','#dayReserver');
					// テーブルのデータが入った変数
					var eachDayReserved = creator.json['eachDayReservedInfoTable']['table'];
					// 日ごと予約者一覧テーブルの値を置換する
					lessonTableValueInput('.eachDayReservedInfoTable', eachDayReserved, "callEachDayReservedValue");
				}
				
				//受講承認タブのコンテンツ
				//タブ
				creator.outputTag('lecturePermitTab', 'tabContainer', '#lecturePermit' );
				//受講承認タブ
				creator.outputTag('doLecturePermit','tabInContent', '.lecturePermitTab');
				//受講承認一覧タブ
				creator.outputTag('lecturePermitList','tabInContent', '.lecturePermitTab');

				// 受講承認テーブル用のJSON配列を取得する
				creator.getJsonFile('php/GetJSONArray.php', creator.json['doLecturePermitInfoTable'], 'doLecturePermitInfoTable');
				//受講承認タブのリストテーブル
				creator.outputTagTable('doLecturePermitInfoTable', 'doLecturePermitInfoTable', '#doLecturePermit');
				//受講承認のボタン
				creator.outputTag('doLecturePermitButton', 'normalButton', '#doLecturePermit');

				//受講承認一覧の検索領域を作る
				creator.outputTag('permitListSearch', 'permitListSearch', '#lecturePermitList');
				//受講承認一覧で今月の初日から末日を検索するのをデフォルトにする
				setPermitListFromToDate();
				// 受講承認一覧テーブル用のJSON配列を取得する
				creator.getJsonFile('php/GetJSONArray.php', creator.json['lecturePermitListInfoTable'], 'lecturePermitListInfoTable');
				if (creator.json.lecturePermitListInfoTable.table[0]) {
					//受講承認一覧タブのリスト
					creator.outputTagTable('lecturePermitListInfoTable', 'lecturePermitListInfoTable', '#lecturePermitList');
				}
				//受講承認一覧のリスト更新ボタン
				creator.outputTag('lecturePermitListUpdateButton', 'normalButton', '#lecturePermitList');
				//クリックでテキストボックスにカレンダーを表示する
				clickCalendar('fromSearach');
				//クリックでテキストボックスにカレンダーを表示する
				clickCalendar('toSearach');
				//受講承認一覧の検索機能を実装する
				searchPermitListInfoTable();
				//会員一覧タブのコンテンツ
				// ユーザ検索テキストボックス
				creator.outputTag('searchUser', 'searchUser', '#userList');
				//ページング機能付きでユーザ情報一覧テーブルを作る(レコードの表示数が15、ページングの最大値が9)
				tablePaging('userListInfoTable', 15, 10);
				// 日ごと予約者一覧テーブル用のJSON配列を取得する
				// creator.getJsonFile('php/GetJSONArray.php', creator.json['userListInfoTable'], 'userListInfoTable');
				//会員一覧タブのリスト
				// creator.outputTagTable('userListInfoTable', 'userListInfoTable', '#userList');
				//会員一覧タブのボタン群れ
				creator.outputTag('userListButtons', 'userListButtons', '#userList');
				
				//画面の先頭にスクロールを戻すボタン
				creator.outputTag('returnTopPosition');
				
				//タブを作る
				createTab('.adminTab');
				createTab('.lecturePermitTab');

				//授業詳細タブ内にカレンダ-作る
				creator.outputTag('adminCalendar', 'adminCalendar', '#lessonDetail');
				//
				// var adminLessonList = new tagDialog(ADMIN_LESSON_LIST_DIALOG, '', dialogOption[ADMIN_LESSON_LIST_DIALOG], function(){
				// 	// 日ごとダイアログ領域を作る
				// 	creator.outputTag(ADMIN_LESSON_LIST_DIALOG, 'dialog', 'body');
				// });
				// カレンダーを作り、クリックでダイアログ作成を作る
				// var admCalendar = new adminCalendar('.adminCalendar', adminLessonList);
				// admCalendar.create();	//カレンダーを実際に作成する

				//受講一覧のテーブルにチェックボックスを追加する
				addCheckbox('permitCheckboxArea', 'permitCheckbox');
				//受講承認に連番を入れる
				lessonTableValueInput('.doLecturePermitInfoTable', creator.json.doLecturePermitInfoTable.table, 'callLecturePermitValue');
				//受講承認一覧に連番を入れる
				insertNo (creator.json.lecturePermitListInfoTable.table, '.lecturePermitListInfoTable', 0);
				//クリックでテキストボックスにカレンダーを表示する
				clickCalendar('lesson_date');
				//会員一覧タブのユーザ検索機能を実装する
				replaceTableTriggerClick('searchList', 'userListInfoTable');
				//管理者日ごと授業の検索機能を実装する
				replaceTableTriggerClick('dateSelect', 'eachDayReservedInfoTable');


				
				//予約一覧ダイアログを作る
				var lessonList = new tagDialog('adminLessonListDialog', '', dialogOption['adminLessonListDialog'], function(){
					// 日ごとダイアログ領域を作る
					creator.outputTag('adminLessonListDialog', 'dialogDiv', 'body');
				});
				
				// 講座のカレンダーを作り、クリックでダイアログ作成を作る
				var lessonCalendar = new adminCalendar('.adminCalendar', lessonList);
				lessonCalendar.create();	//カレンダーを実際に作成する
				
				//授業詳細ダイアログを作る
				var lessonDetailDialog = new tagDialog(LESSON_DETAIL_DIALOG, '', dialogOption[LESSON_DETAIL_DIALOG], function(){
					// 授業詳細ダイアログ領域を作る
					creator.outputTag(LESSON_DETAIL_DIALOG, LESSON_DETAIL_DIALOG, 'body');
				});

				//メルマガ＆アナウンスタブのコンテンツ
				//過去のメルマガを検索するための領域を作る
				creator.outputTag('mailMagaSearchArea', 'mailMagaSearchArea', '#mailMagaAndAnnounce');
				//メルマガテーブルの外側を作る
				creator.outputTag('mailMagaTableArea', 'tableOutsideArea', '#mailMagaAndAnnounce');
				//受講済み授業テーブル用のJSON配列を取得する
				creator.getJsonFile('php/GetJSONArray.php', creator.json['mailMagaTable'], 'mailMagaTable');
				//メルマガテーブルを作る
				//creator.outputTagTable('mailMagaTable', 'mailMagaTable', '.mailMagaTableArea');
				//メルマガ・アナウンス入力領域を作る
				creator.outputTag('mailMagaAndAnnounceArea', 'mailMagaAndAnnounceArea', '#mailMagaAndAnnounce');
				// ボタンの見た目をjqueryuiのものにする
				$('button, .searchButton, input[type="button"]').button();
				//会員一覧の検索の中にあるテキストボックスにフォーカスしているときにエンターキー押下で検索ボタンを自動でクリックする
				enterKeyButtonClick('.searchNameTextbox, .searchNameKanaTextbox, .searchPhoneTextbox, .searchMailAddressTextbox', '.searchMailAddress .searchButton');
				
				//受講承認一覧テーブルの料金列をテキストボックスにする
				insertTextboxToTable('lecturePermitListInfoTable', 'replaceTextboxCost', 'replaceTextboxCostCell');
				//受講承認一覧テーブルの使用pt列をテキストボックスにする
				insertTextboxToTable('lecturePermitListInfoTable', 'replaceTextboxUsePoint', 'replaceTextboxUsePointCell');
				//受講承認一覧テーブルのテキストボックスにDBから読込んだ値をデフォルトで入れる
				setTableTextboxValuefromDB(creator.json['lecturePermitListInfoTable']['table'], setInputValueToLecturePermitListInfoTable);

				// tablePaging('finishedLessonTable', 15, 6);
				//会員になり替わってログインするために、ユーザ一覧テーブルの会員の行をクリックしたときにクリックした会員で会員ページにログインする
				loginInsteadOfMember('#userList', '.userListInfoTable tr');
				//受講承認一覧テーブルの検索機能を実装する
				searchPermitListInfoTable();
				// insertTableRecord();

			});
			</script>
		</div>
	</div>
</body>
</html>