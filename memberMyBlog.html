<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>DDTFlowers/マイページ</title>
</head>
<body>
	<div id="container">
		<div class="main">
			<!-- コース案内のCSSファイルを読み込む。 -->
			<link href="css/courseguide.css" rel="stylesheet" type="text/css">
			<!-- マイページのCSSファイルを読み込む。 -->
			<link href="css/mypage.css" rel="stylesheet" type="text/css">
			<!-- 予約希望ダイアログのCSSファイルを読み込む。 -->
			<link href="css/special.css" rel="stylesheet" type="text/css">
			<script>
				hideNormalHeader();	//通常ページのヘッダーを隠す
				// dom要素を作るクラスをインスタンス化する
				var myBlogCreator = new createTag();
				// 会員共通のパーツのJSONを取得する。
				myBlogCreator.getDomFile('template/memberCommon.html');
				// 会員ページのjsonを読み込む
				myBlogCreator.getDomFile('template/memberPage.html');
				//ユーザ情報のテキストをDBから取得する
				myBlogCreator.getJsonFile('php/GetJSONString.php', myBlogCreator.json['memberHeader'], 'memberHeader');
				// 会員ページヘッダーを作る
				myBlogCreator.outputTag('memberHeader');
				// バナー領域を作る
				myBlogCreator.outputTag('userBanner');
				
				myBlogCreator.getJsonFile('source/commonJson.json');		// 各ページ共通のパーツのJSONデータを取得する。
				myBlogCreator.getJsonFile('source/mypage.json');// 各ページ共通のパーツのJSONを取得する。
				myBlogCreator.getJsonFile('source/mypagecontent.json');	// マイページの動的なコンテンツのJSONを取得する。
				// ファイルのhtmlデータをdomを用いて持ってくる
				myBlogCreator.getDomFile('template/common.html');
				myBlogCreator.getDomFile('template/mypage.html');
				myBlogCreator.getDomFile('template/table.html');

				myBlogCreator.getJsonFile('source/mypagebloglist.json');	// マイページのブログ一覧のJSONを取得する。

				// ブログ管理領域を作る。
				myBlogCreator.outputTag('myPageBlog');
				myBlogCreator.outputTag('myPageBlogTitle','myPageBlogTitle','.myPageBlog');		// タイトル領域を作る

				//ボタンを作る
				myBlogCreator.outputTag('myPageBlogButtons','myPageBlogButtons','.myPageBlog');

				//会員番号をブログ検索のjsonに入れて置換できるようにし、会員ごとのブログ記事を読み込むのの使う
				myBlogCreator.json.myBlogListTable.user_key.value = myBlogCreator.json.memberHeader.user_key.value;

				myBlogCreator.outputTag("blogArticles",'blogArticles','.myPageBlog');			//Myページのブログ領域
				myBlogCreator.outputTag('numberingOuter', 'numberingOuter', '.myPageBlog');	// ナンバリング領域を作る
				
				//ブログのデータをDBから取得しブログリストのテーブルを作るためにjson化する
				myBlogCreator.getJsonFile('php/GetJSONArray.php', myBlogCreator.json['myBlogListTable'], 'myBlogListTable');
				//ブログの投稿したことがある人のみブログリストテーブルを作る
				if(myBlogCreator.json.myBlogListTable.table.length != 0) {
					//ブログリストのテーブルを作る
					myBlogCreator.outputTagTable('myBlogListTable','myBlogListTable','.myPageBlog');
					//テーブルの1列目をチェックボックスにする
					addCheckbox('checkWrap', 'check');
					//チェックボックスにチェックが入ったらすべてのチェックボックスに影響を与えるイベントを登録する
					allCheckbox('.check:eq(0)', '.check');
				}

				//変更者 T.Yamamoto 日付:2015.07.22
				//変更内容:以下のコメントアウトの内容はページング対応時に使うため、ページング対応ができるまでコメントアウトします。
				// //表形式のブログリストの外枠を作る。
				// creator.outputTag('managementList', 'managementList', '.myPageBlog');
				// //表の見出しを作る。
				// creator.outputTag('blogListHeadWrap', 'blogListHeadWrap', '.managementList .table');
				// //DOM配置の都合上付いてしまった親のtableタグを消す。
				// unwrapTable('.blogListHead');
				// //表の内容を作る。
			 	// 	outputKeyNumberObject(creator.json, 'blogListContentWrap', '.managementList .table');
				
				//ユーザのブログ領域用のJSONに会員IDをセットする。
				myBlogCreator.json.myBlogTable.user_key.value = myBlogCreator.json.memberHeader.user_key.value;
				//ユーザ情報のテキストをDBから取得する
				myBlogCreator.getJsonFile('php/GetJSONArray.php', myBlogCreator.json['myBlogTable'], 'myBlogTable');
				myBlogCreator.outputNumberingTag('myBlogTable', 1, 4, 1, 2, '.blogArticles', 'createMyBlogImages');	// ブログの記事を作る。
				
				sendButtonRole($('form'));	//押されたsubmitボタンを検出する関数。
				//submitイベントを登録する。
				$('form').validate(articleSubmitHandler);
				deleteRowData('form', 'deleteMyBlog', myBlogCreator);	//行の削除イベントを登録する。
				addlogoutEvent('.logoutLink');	//ログアウトボタンのイベントを登録する。
			</script>
		</div>
	</div>
</body>
</html>